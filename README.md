# IMEの状態をLEDで表示するやつ

IMEの日本語入力の状態がオンなのかオフなのかわからなくなり、日本語入力したいのに英字になったり、英字入力したいのに日本語になったりして困ってたので、ATOM Matrixと組み合わせてLEDをゲーミングPCのように光らせるやつを作ってみました。

詳しい説明は[ブログ](https://akibabara.com/blog/7092.html)を参照してください。

# 想定するシステム構成
Windows PC --> M5Stack親機 --> M5Stack子機<br>
子機はオプションで、無くても使えます

# しくみ
Pythonで作成したプログラムでIMEの状態を監視し、シリアルポートに接続したM5Stack親機にデータを送信します。親機単体でもLEDを光らせることができます。親機はESPNOWを利用して子機にデータを送信することもできます。それにより、子機も親機と連動してLEDを光らせることができます。
ESPNOWはWi-Fiでデータを送信する仕組みですが、SSID等の設定は不要です。

# おすすめ構成
おすすめは親機をAtomS3Uにして、子機をATOMシリーズにする方法です。AtomS3UはUSBスティック型なので直接PCに差すことができ、子機でLEDを光らせれば配線の自由度が増します。親機のみでも使用可能です。
* 親機 [AtomS3U](https://docs.m5stack.com/en/core/AtomS3U) 
* 子機 [ATOM Matrix](https://docs.m5stack.com/en/core/ATOM%20Matrix) ＋ RGB LEDテープライト

# PC側のセットアップ

## (1) ビルド
Pythonの環境を整えたうえで、pythonフォルダの build_exe_file.bat を実行するとバイナリが作成されます。必要なライブラリはソースを参考にしてください。

## (2) 設定
ime2serialwrite.exe があるフォルダの中に config.ini というファイルを用意します。pythonフォルダの中の config.ini を参考にしてください。port= の部分を自分の環境に合わせて変更してください。

## (3) 実行
実行するとタスクトレイの中で最小化しています。基本的に操作は不要ですが、右クリックでメニューが表示されます。

# M5Stack側のセットアップ
FastLEDライブラリが必要です。

## (1) 情報の整理
使用するモデルに応じてGPIOのポート番号やLEDの数が違うので、m5ime_light.ino のコメントを参考にして、自分の環境に合わせて修正します。外部LEDとはPort Aに接続するRGB LEDのことです。外部LEDを接続しない場合はそのままでかまいません。

## (2) 子機のコンパイル（子機を使う場合）
子機を使う場合は、子機のMACアドレス情報が必要になるので、先に子機からコンパイルしていきます。子機を使わない場合は飛ばして次へ進んでください。m5ime_light.inoの IS_MASTER をfalseにしてコンパイルします。こうすると子機用として動作します。Arduino IDEのシリアルモニターを開き、M5Stackが起動するとコンソールにMACアドレス表示されるので控えておきます。

## (3) M5Stack親機のコンパイル
子機を使う場合は、子機のMACアドレスを SLAVE_MAC_ADDRESS_1 に記述してください。m5ime_light.inoの IS_MASTER をtrueにしてコンパイルします。こうすると親機用として動作します。

# 使い方
特に何もありません。正常に接続できていればIMEのオン/オフに応じてLEDが光ると思います。

GroveポートにLEDテープライトを接続したり、ここでは説明していないM5Stack側の操作、Windows側の操作については[ブログ](https://akibabara.com/blog/7092.html)をご覧ください。

## TIPS
Arduino IDEを起動しているとシリアルポートが独占されてしまうので使用時は終了しておきましょう。逆もまた然り。
